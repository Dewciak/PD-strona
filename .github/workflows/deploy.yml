name: Deploy to Hostinger

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    # To mówi GitHubowi: "Wszystkie komendy wykonuj wewnątrz tego folderu"
    defaults:
      run:
        working-directory: ./PD-fotografia

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: npm install

      - name: Build project
        run: npm run build

      - name: Deploy via SFTP
        run: |
          sudo apt-get update && sudo apt-get install -y lftp
          lftp -e "
            set sftp:auto-confirm yes;
            set net:timeout 30;
            set net:max-retries 3;
            set net:reconnect-interval-base 5;
            mirror -R --verbose --delete ./dist/ /public_html/;
            quit;
          " -u "${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }}" sftp://${{ secrets.FTP_SERVER }}:65002
